{"remainingRequest":"/home/cyding/speedle-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/cyding/speedle-ui/src/components/PolicyStore.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/cyding/speedle-ui/src/components/PolicyStore.vue","mtime":1596354952410},{"path":"/home/cyding/speedle-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/cyding/speedle-ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/cyding/speedle-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/cyding/speedle-ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnUG9saWN5U3RvcmUnLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBnZXRTZXJ2aWNlc1N1Y2NlZWQ6IGZhbHNlLAogICAgICBzZXJ2aWNlU2VhcmNoOiAnJywKICAgICAgZnVuY3Rpb25TZWFyY2g6ICcnLAogICAgICBzZXJ2aWNlczogW10sCiAgICAgIG5ld1N2YzogewogICAgICAgIG5hbWU6ICcnLAogICAgICAgIHR5cGU6ICcnLAogICAgICB9LAogICAgICBuZXdTdmNOYW1lU3RhdGU6IG51bGwsCiAgICAgIGZ1bmN0aW9uczogW10sCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGZpbHRlcmVkU2VydmljZXMoKSB7CiAgICAgIHJldHVybiB0aGlzLnNlcnZpY2VzLmZpbHRlcigKICAgICAgICAoc2VydmljZSkgPT4gc2VydmljZS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGhpcy5zZXJ2aWNlU2VhcmNoLnRvTG93ZXJDYXNlKCkpLAogICAgICApOwogICAgfSwKICAgIGZpbHRlcmVkRnVuY3Rpb25zKCkgewogICAgICByZXR1cm4gdGhpcy5mdW5jdGlvbnMuZmlsdGVyKAogICAgICAgIChmKSA9PiBmLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0aGlzLmZ1bmN0aW9uU2VhcmNoLnRvTG93ZXJDYXNlKCkpLAogICAgICApOwogICAgfSwKICAgIHBtc0VuZHBvaW50KCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUucG1zRW5kcG9pbnQ7CiAgICB9LAogIH0sCiAgd2F0Y2g6IHsKICAgIHBtc0VuZHBvaW50KG5ld1ZhbCkgewogICAgICBpZiAobmV3VmFsICE9PSAnJykgewogICAgICAgIHRoaXMuc2V0U3ZjTmFtZSgnJyk7CiAgICAgICAgdGhpcy5yZWZyZXNoU2VydmljZXMoKTsKICAgICAgfQogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIHNldFN2Y05hbWUoc3ZjTmFtZSkgewogICAgICBjb25zb2xlLmxvZyh0aGlzLiRzdG9yZS5zdGF0ZS5zdmNOYW1lKTsKICAgICAgaWYgKHN2Y05hbWUgIT09IHRoaXMuJHN0b3JlLnN0YXRlLnN2Y05hbWUpIHsKICAgICAgICBjb25zb2xlLmxvZyhgc2V0U3ZjTmFtZSAke3N2Y05hbWV9YCk7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCd1cGRhdGVTdmNOYW1lJywgc3ZjTmFtZSk7CiAgICAgIH0KICAgIH0sCiAgICByZWZyZXNoU2VydmljZXMoKSB7CiAgICAgIHRoaXMuYXhpb3MuZ2V0KGAke3RoaXMucG1zRW5kcG9pbnR9L3NlcnZpY2VgKS50aGVuKChyZXNwKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2cocmVzcC5kYXRhKTsKICAgICAgICB0aGlzLnNlcnZpY2VzID0gcmVzcC5kYXRhOwogICAgICAgIHRoaXMuZ2V0U2VydmljZXNTdWNjZWVkID0gdHJ1ZTsKICAgICAgfSkuY2F0Y2goKGVycikgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgICAgdGhpcy5zZXJ2aWNlcyA9IFtdOwogICAgICAgIHRoaXMuJGJ2VG9hc3QudG9hc3QoYCR7ZXJyLm1lc3NhZ2V9YCwgewogICAgICAgICAgdGl0bGU6ICdGYWlsIHRvIGdldCBzZXJ2aWNlcycsCiAgICAgICAgICB2YXJpYW50OiAnZGFuZ2VyJywKICAgICAgICAgIHNvbGlkOiB0cnVlLAogICAgICAgIH0pOwogICAgICAgIHRoaXMuZ2V0U2VydmljZXNTdWNjZWVkID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGRlbGV0ZVN2YyhzdmNOYW1lKSB7CiAgICAgIGNvbnNvbGUubG9nKGBkZWxldGVTdmMgJHtzdmNOYW1lfWApOwogICAgICB0aGlzLmF4aW9zLmRlbGV0ZShgJHt0aGlzLnBtc0VuZHBvaW50fS9zZXJ2aWNlLyR7c3ZjTmFtZX1gKS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgIHRoaXMucmVmcmVzaFNlcnZpY2VzKCk7CiAgICAgICAgaWYgKHRoaXMuJHN0b3JlLnN0YXRlLnN2Y05hbWUgPT09IHN2Y05hbWUpIHsKICAgICAgICAgIHRoaXMuc2V0U3ZjTmFtZSgnJyk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICB0aGlzLiRidlRvYXN0LnRvYXN0KGAke2Vyci5tZXNzYWdlfWAsIHsKICAgICAgICAgIHRpdGxlOiBgRmFpbCB0byBkZWxldGUgc2VydmljZSAke3N2Y05hbWV9YCwKICAgICAgICAgIHZhcmlhbnQ6ICdkYW5nZXInLAogICAgICAgICAgc29saWQ6IHRydWUsCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGNyZWF0ZVN2YygpIHsKICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZVN2YycpOwogICAgICBjb25zb2xlLmxvZyh0aGlzLm5ld1N2Yy5uYW1lKTsKICAgICAgdGhpcy5heGlvcy5wb3N0KGAke3RoaXMucG1zRW5kcG9pbnR9L3NlcnZpY2VgLAogICAgICAgIHsgbmFtZTogdGhpcy5uZXdTdmMubmFtZSwgdHlwZTogdGhpcy5uZXdTdmMudHlwZSB9KS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgIHRoaXMucmVmcmVzaFNlcnZpY2VzKCk7CiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgICAgIHRoaXMuJGJ2VG9hc3QudG9hc3QoYCR7ZXJyLm1lc3NhZ2V9YCwgewogICAgICAgICAgdGl0bGU6ICdGYWlsIHRvIGNyZWF0ZSBzZXJ2aWNlJywKICAgICAgICAgIHZhcmlhbnQ6ICdkYW5nZXInLAogICAgICAgICAgc29saWQ6IHRydWUsCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc2V0TmV3U3ZjKCkgewogICAgICB0aGlzLm5ld1N2Yy5uYW1lID0gJyc7CiAgICAgIHRoaXMubmV3U3ZjLnR5cGUgPSAnJzsKICAgICAgdGhpcy5uZXdTdmNOYW1lU3RhdGUgPSBudWxsOwogICAgfSwKICAgIGNoZWNrRm9ybVZhbGlkaXR5KCkgewogICAgICBjb25zb2xlLmxvZygnY2hlY2tGb3JtVmFsaWRpdHkuLi4nKTsKICAgICAgY29uc3QgdmFsaWQgPSB0aGlzLiRyZWZzLmNyZWF0ZVN2Y2Zvcm0uY2hlY2tWYWxpZGl0eSgpOwogICAgICB0aGlzLm5ld1N2Y05hbWVTdGF0ZSA9IHZhbGlkOwogICAgICByZXR1cm4gdmFsaWQ7CiAgICB9LAogICAgaGFuZGxlT2soYnZNb2RhbEV2dCkgewogICAgICBjb25zb2xlLmxvZygnaGFuZGxlT2suLi4nKTsKICAgICAgLy8gUHJldmVudCBtb2RhbCBmcm9tIGNsb3NpbmcKICAgICAgYnZNb2RhbEV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAvLyBUcmlnZ2VyIHN1Ym1pdCBoYW5kbGVyCiAgICAgIHRoaXMuaGFuZGxlU3VibWl0KCk7CiAgICB9LAogICAgaGFuZGxlU3VibWl0KCkgewogICAgICBjb25zb2xlLmxvZygnaGFuZGxlU3VibWl0Li4uJyk7CiAgICAgIC8vIEV4aXQgd2hlbiB0aGUgZm9ybSBpc24ndCB2YWxpZAogICAgICBpZiAoIXRoaXMuY2hlY2tGb3JtVmFsaWRpdHkoKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmNyZWF0ZVN2YygpOwogICAgICAvLyBIaWRlIHRoZSBtb2RhbCBtYW51YWxseQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgdGhpcy4kYnZNb2RhbC5oaWRlKCdjcmVhdGVTdmMnKTsKICAgICAgfSk7CiAgICB9LAogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMucmVmcmVzaFNlcnZpY2VzKCk7CiAgICB0aGlzLmF4aW9zLmdldChgJHt0aGlzLnBtc0VuZHBvaW50fS9mdW5jdGlvbmApLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICB0aGlzLmZ1bmN0aW9ucyA9IHJlc3BvbnNlLmRhdGE7CiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgIHRoaXMuJGJ2VG9hc3QudG9hc3QoYCR7ZXJyLm1lc3NhZ2V9YCwgewogICAgICAgIHRpdGxlOiAnRmFpbCB0byBnZXQgZnVuY3Rpb25zJywKICAgICAgICB2YXJpYW50OiAnZGFuZ2VyJywKICAgICAgICBzb2xpZDogdHJ1ZSwKICAgICAgfSk7CiAgICB9KTsKICB9LAp9Owo="},{"version":3,"sources":["PolicyStore.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PolicyStore.vue","sourceRoot":"src/components","sourcesContent":["<template>\n<b-card bg-variant=\"light\"\n no-body class=\"border-0 rounded-0  vh-100 overflow-auto\">\n  <!--<b-card-header v-if=\"getServicesSucceed\" class=\"border-right rounded-0\">-->\n  <b-card-header class=\"border-right rounded-0\">\n    <b-row>\n      <b-col cols=\"8\">\n        Policy Store Navigation\n      </b-col>\n      <b-col cols=\"4\">\n        <b-button @click=\"refreshServices\" pill variant=\"outline-success\">\n            <b-icon icon=\"arrow-repeat\" aria-hidden=\"true\" size=\"sm\"></b-icon>\n        </b-button>\n      </b-col>\n    </b-row>\n  </b-card-header>\n  <!--<b-card-header v-else header-bg-variant=\"danger\" header-text-variant=\"white\"\n   class=\"border-left rounded-0\">\n      Pls set PMS endpoint correctly!!!\n  </b-card-header>-->\n  <b-card-body class=\"border-right\">\n    <b-row class=\"mt-3 mb-2 \">\n      <b-col cols=\"5\">\n        <b-button block v-b-toggle.service-list variant=\"primary\">\n          Services\n        </b-button>\n      </b-col>\n      <b-col cols=\"3\">\n        <b-button v-b-modal.createSvc pill variant=\"outline-success\">\n          <b-icon icon=\"pencil-square\" aria-hidden=\"true\"></b-icon>\n        </b-button>\n        <b-modal id=\"createSvc\" title=\"Create Service\"\n               ref=\"createSvcModal\"\n               @show=\"resetNewSvc\"\n               @hidden=\"resetNewSvc\"\n               @ok=\"handleOk\">\n          <form ref=\"createSvcform\" @submit.stop.prevent=\"handleSubmit\">\n            <b-form-group label=\"Name:\" label-align=\"right\" label-cols=\"4\" label-for=\"input-name\">\n              <b-form-input id=\"input-name\" v-model=\"newSvc.name\"\n               :state=\"newSvcNameState\" required></b-form-input>\n            </b-form-group>\n            <b-form-group label=\"Type:\" label-align=\"right\" label-cols=\"4\" label-for=\"input-type\">\n              <b-form-input id=\"input-type\" v-model=\"newSvc.type\"></b-form-input>\n            </b-form-group>\n          </form>\n        </b-modal>\n      </b-col>\n      <b-col cols=\"3\">\n        <b-form-input  type=\"text\"\n        v-model=\"serviceSearch\" placeholder=\"*\"/>\n      </b-col>\n    </b-row>\n    <b-collapse id=\"service-list\">\n      <b-list-group flush>\n        <b-list-group-item button\n          v-for=\"s in filteredServices\" :key=\"s.name\" @click=\"setSvcName(s.name)\">\n          <b-row>\n            <b-col cols=\"2\"/>\n            <b-col cols=\"7\">{{s.name}}</b-col>\n            <b-col cols=\"3\">\n              <b-button class=\"h-75 mb-2\" pill variant=\"outline-danger\" size=\"sm\"\n                    v-b-modal=\"s.name\" @click.stop>\n                <b-icon icon=\"trash\" aria-hidden=\"true\"></b-icon>\n              </b-button>\n              <b-modal :id=\"s.name\" title=\"Delete Service\"  @ok=\"deleteSvc(s.name)\">\n                <p class=\"my-4\">Continue deleting service {{s.name}}</p>\n              </b-modal>\n            </b-col>\n          </b-row>\n        </b-list-group-item>\n      </b-list-group>\n    </b-collapse>\n\n    <b-row class=\"mt-3 mb-2\">\n      <b-col cols=\"5\">\n        <b-button  block v-b-toggle.function-list variant=\"primary\">\n          Functions\n        </b-button>\n      </b-col>\n      <b-col cols=\"3\">\n        <b-button pill variant=\"outline-success\"\n        @click=\"createSvc\">\n        <b-icon icon=\"pencil-square\" aria-hidden=\"true\"></b-icon>\n        </b-button>\n      </b-col>\n      <b-col cols=\"3\">\n        <b-form-input  type=\"text\"\n        v-model=\"functionSearch\" placeholder=\"*\"/>\n      </b-col>\n    </b-row>\n    <b-collapse id=\"function-list\">\n      <b-list-group flush>\n        <b-list-group-item v-for=\"s in filteredFunctions\" :key=\"s.name\" href=\"#\">\n          <b-row>\n            <b-col cols=\"2\"/>\n            <b-col cols=\"7\">{{s.name }}</b-col>\n            <b-col cols=\"3\">\n              <b-button cols=\"4\" class=\"h-75 mb-2\" pill variant=\"outline-danger\" size=\"sm\"\n                    @click=\"removeService(s.name)\">\n                    <b-icon icon=\"trash\" aria-hidden=\"true\"></b-icon>\n              </b-button>\n            </b-col>\n          </b-row>\n        </b-list-group-item>\n      </b-list-group>\n    </b-collapse>\n  </b-card-body>\n</b-card>\n</template>\n\n<script>\nexport default {\n  name: 'PolicyStore',\n  data() {\n    return {\n      getServicesSucceed: false,\n      serviceSearch: '',\n      functionSearch: '',\n      services: [],\n      newSvc: {\n        name: '',\n        type: '',\n      },\n      newSvcNameState: null,\n      functions: [],\n    };\n  },\n  computed: {\n    filteredServices() {\n      return this.services.filter(\n        (service) => service.name.toLowerCase().includes(this.serviceSearch.toLowerCase()),\n      );\n    },\n    filteredFunctions() {\n      return this.functions.filter(\n        (f) => f.name.toLowerCase().includes(this.functionSearch.toLowerCase()),\n      );\n    },\n    pmsEndpoint() {\n      return this.$store.state.pmsEndpoint;\n    },\n  },\n  watch: {\n    pmsEndpoint(newVal) {\n      if (newVal !== '') {\n        this.setSvcName('');\n        this.refreshServices();\n      }\n    },\n  },\n  methods: {\n    setSvcName(svcName) {\n      console.log(this.$store.state.svcName);\n      if (svcName !== this.$store.state.svcName) {\n        console.log(`setSvcName ${svcName}`);\n        this.$store.commit('updateSvcName', svcName);\n      }\n    },\n    refreshServices() {\n      this.axios.get(`${this.pmsEndpoint}/service`).then((resp) => {\n        console.log(resp.data);\n        this.services = resp.data;\n        this.getServicesSucceed = true;\n      }).catch((err) => {\n        console.log(err);\n        this.services = [];\n        this.$bvToast.toast(`${err.message}`, {\n          title: 'Fail to get services',\n          variant: 'danger',\n          solid: true,\n        });\n        this.getServicesSucceed = false;\n      });\n    },\n    deleteSvc(svcName) {\n      console.log(`deleteSvc ${svcName}`);\n      this.axios.delete(`${this.pmsEndpoint}/service/${svcName}`).then((response) => {\n        console.log(response.data);\n        this.refreshServices();\n        if (this.$store.state.svcName === svcName) {\n          this.setSvcName('');\n        }\n      }).catch((err) => {\n        console.log(err);\n        this.$bvToast.toast(`${err.message}`, {\n          title: `Fail to delete service ${svcName}`,\n          variant: 'danger',\n          solid: true,\n        });\n      });\n    },\n    createSvc() {\n      console.log('createSvc');\n      console.log(this.newSvc.name);\n      this.axios.post(`${this.pmsEndpoint}/service`,\n        { name: this.newSvc.name, type: this.newSvc.type }).then((response) => {\n        console.log(response.data);\n        this.refreshServices();\n      }).catch((err) => {\n        console.log(err);\n        this.$bvToast.toast(`${err.message}`, {\n          title: 'Fail to create service',\n          variant: 'danger',\n          solid: true,\n        });\n      });\n    },\n    resetNewSvc() {\n      this.newSvc.name = '';\n      this.newSvc.type = '';\n      this.newSvcNameState = null;\n    },\n    checkFormValidity() {\n      console.log('checkFormValidity...');\n      const valid = this.$refs.createSvcform.checkValidity();\n      this.newSvcNameState = valid;\n      return valid;\n    },\n    handleOk(bvModalEvt) {\n      console.log('handleOk...');\n      // Prevent modal from closing\n      bvModalEvt.preventDefault();\n      // Trigger submit handler\n      this.handleSubmit();\n    },\n    handleSubmit() {\n      console.log('handleSubmit...');\n      // Exit when the form isn't valid\n      if (!this.checkFormValidity()) {\n        return;\n      }\n      this.createSvc();\n      // Hide the modal manually\n      this.$nextTick(() => {\n        this.$bvModal.hide('createSvc');\n      });\n    },\n  },\n  mounted() {\n    this.refreshServices();\n    this.axios.get(`${this.pmsEndpoint}/function`).then((response) => {\n      console.log(response.data);\n      this.functions = response.data;\n    }).catch((err) => {\n      console.log(err);\n      this.$bvToast.toast(`${err.message}`, {\n        title: 'Fail to get functions',\n        variant: 'danger',\n        solid: true,\n      });\n    });\n  },\n};\n</script>\n"]}]}